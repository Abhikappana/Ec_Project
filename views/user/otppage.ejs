<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" type="text/css" href="css/main.css">
</head>

<body>
    <div class="otp">

        <form action="/verifyOTP" method="post" class="form">
            <div class="flex-column">
                <h1>Verify</h1>
            </div>

            <div class="flex-column">
                <p>Otp is sent to <span class="span"><a>
                            <%= email %>
                        </a></span>
            </div>
            <div class="inputForm">

                <input type="number" id="number" class="input" name="otp" placeholder="Enter your otp" required
                    maxlength="6" onkeyup="validateOTP()">

            </div>
            <p class="error-message" id="otp-error"><%= message %></p>
            
            <button onclick="return validateOTPForm()" class="button-submit" type="submit">Procced</button>


            </p>
<!-- Countdown and Resend OTP button -->
<div class="d-flex justify-content-between align-items-center">
    <div>
        <p id="countdown">Waiting for OTP...</p>
    </div>
    <div>
        <button id="resendButton" onclick="resendOTP()" class="btn btn-primary" disabled>Resend OTP</button>
    </div>
</div>

        </form>
        

    </div>


    <script>

        /*    OTP VALIDATION     */
        var otpError = document.getElementById("otp-error");
        var submitOTPError = document.getElementById("submitOTP-error");
        var invalidOTP = document.getElementById("invalidotp");
        invalidOTP.style.display = 'block';
        setTimeout(() => {
            invalidOTP.style.display = "none"
        }, 2000)

        function validateOTP() {
            var otpname = document.getElementById("otp").value;
            if (otpname.length == 0) {
                otpError.innerHTML = "Please enter OTP";
                return false;

            } else if (!otpname.match(/^[0-9]{4,}$/)) {
                otpError.innerHTML = "Only numbers allowed";
                return false;
            }

            else if (otpname.length != 6) {
                otpError.innerHTML = "6 digit OTP";
                return false;
            }

            otpError.innerHTML = "valid";
            return true;
        }

        function validateOTPForm() {
            if (!validateOTP()) {
                submitOTPError.style.display = "block";
                submitOTPError.innerHTML = "OTP required";
                setTimeout(() => {
                    submitOTPError.style.display = "none";
                }, 2000);
                return false;
            }

        }


    </script>

    <script>
        let countdownValue = 60; // Countdown duration in seconds
        let countdownInterval;

        function startCountdown() {
            countdownInterval = setInterval(function () {
                if (countdownValue > 0) {
                    countdownValue--;
                    document.getElementById('countdown').innerText = `Resend OTP in ${countdownValue} seconds`;
                } else {
                    clearInterval(countdownInterval);
                    document.getElementById('countdown').innerText = 'Waiting for OTP...';
                    document.getElementById('resendButton').disabled = false;
                }
            }, 1000);
        }

        function resendOTP() {
            // Simulate OTP resend logic
            // Replace this with your actual OTP resend logic   

            window.location.href = "/regResOTP/<%=email %>"

            // Disable the resend button and start the countdown
            document.getElementById('resendButton').disabled = true;
            countdownValue = 60; // Reset countdown value
            startCountdown();
        }

        // Start the initial countdown
        startCountdown();
    </script>

</body>

</html>